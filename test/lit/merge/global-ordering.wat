;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; RUN: wasm-merge %s first %s.second second -all -S -o - | filecheck %s

;; After the merge this module's global will read a value from a global that is
;; appended after it, from the second module. Those must be reordered so that
;; we validate, as a global can only read from previous ones.

(module
  (import "second" "second.global.export" (global i32))

  ;; CHECK:      (type $0 (func (result i32)))

  ;; CHECK:      (global $second.global i32 (i32.const 42))

  ;; CHECK:      (global $first.global (mut i32) (global.get $second.global))
  (global $first.global (mut i32) (global.get 0))

  ;; CHECK:      (export "run" (func $run))

  ;; CHECK:      (export "second.global.export" (global $second.global))

  ;; CHECK:      (func $run (type $0) (result i32)
  ;; CHECK-NEXT:  (global.get $first.global)
  ;; CHECK-NEXT: )
  (func $run (export "run") (result i32)
    ;; Use the global to avoid it being removed.
    (global.get $first.global)
  )
)
