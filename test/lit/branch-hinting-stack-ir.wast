;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; RUN: wasm-opt -all             %s -S -o - | filecheck %s
;; RUN: wasm-opt -all --roundtrip %s -S -o - | filecheck %s

(module
 ;; CHECK:      (type $0 (func))

 ;; CHECK:      (func $empty-if (type $0)
 ;; CHECK-NEXT:  (local $1 i32)
 ;; CHECK-NEXT:  (local.set $1
 ;; CHECK-NEXT:   (i32.const 0)
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT:  (drop
 ;; CHECK-NEXT:   (i32.const 0)
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT:  (@metadata.code.branch_hint "\00")
 ;; CHECK-NEXT:  (if
 ;; CHECK-NEXT:   (local.get $1)
 ;; CHECK-NEXT:   (then
 ;; CHECK-NEXT:    (nop)
 ;; CHECK-NEXT:   )
 ;; CHECK-NEXT:   (else
 ;; CHECK-NEXT:    (nop)
 ;; CHECK-NEXT:   )
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT: )
 ;; RTRIP:      (type $0 (func))

 ;; RTRIP:      (func $empty-if (type $0)
 ;; RTRIP-NEXT:  (local $1 i32)
 ;; RTRIP-NEXT:  (local.set $1
 ;; RTRIP-NEXT:   (i32.const 0)
 ;; RTRIP-NEXT:  )
 ;; RTRIP-NEXT:  (drop
 ;; RTRIP-NEXT:   (i32.const 0)
 ;; RTRIP-NEXT:  )
 ;; RTRIP-NEXT:  (@metadata.code.branch_hint "\00")
 ;; RTRIP-NEXT:  (if
 ;; RTRIP-NEXT:   (local.get $1)
 ;; RTRIP-NEXT:   (then
 ;; RTRIP-NEXT:    (nop)
 ;; RTRIP-NEXT:   )
 ;; RTRIP-NEXT:   (else
 ;; RTRIP-NEXT:    (nop)
 ;; RTRIP-NEXT:   )
 ;; RTRIP-NEXT:  )
 ;; RTRIP-NEXT: )
 (func $empty-if
  (local $1 i32)
  ;; Several stack IR opts work here, leading to the if arms being empty (nops
  ;; removed) and the local.set vanishing, leaving
  ;;
  ;;  i32.const 0
  ;;  i32.const 0
  ;;  drop
  ;;  if
  ;;  else
  ;;  end
  ;;
  ;; We should not error during computation of the location of the if, and the
  ;; branch hint should remain.
  (local.set $1
   (i32.const 0)
  )
  (drop
   (i32.const 0)
  )
  (@metadata.code.branch_hint "\00")
  (if
   (local.get $1)
   (then
    (nop)
   )
   (else
    (nop)
   )
  )
 )
)

