;; NOTE: Assertions have been generated by update_lit_checks.py and should not be edited.
;; RUN: wasm-opt %s -all -S -o - | filecheck %s

(module
 ;; CHECK:      (tag $e (param i32))
 (tag $e (param i32))

 ;; CHECK:      (func $stacky (type $0) (param $0 i32)
 ;; CHECK-NEXT:  (local $scratch i32)
 ;; CHECK-NEXT:  (local $2 i32)
 ;; CHECK-NEXT:  (try
 ;; CHECK-NEXT:   (do
 ;; CHECK-NEXT:    (nop)
 ;; CHECK-NEXT:   )
 ;; CHECK-NEXT:   (catch $e
 ;; CHECK-NEXT:    (local.set $2
 ;; CHECK-NEXT:     (pop i32)
 ;; CHECK-NEXT:    )
 ;; CHECK-NEXT:    (local.set $0
 ;; CHECK-NEXT:     (block (result i32)
 ;; CHECK-NEXT:      (local.set $scratch
 ;; CHECK-NEXT:       (local.get $2)
 ;; CHECK-NEXT:      )
 ;; CHECK-NEXT:      (nop)
 ;; CHECK-NEXT:      (local.get $scratch)
 ;; CHECK-NEXT:     )
 ;; CHECK-NEXT:    )
 ;; CHECK-NEXT:   )
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT: )
 (func $stacky (param i32)
  try
  catch $e
   ;; The implicit pop is set to a scratch local to be hoisted above the nop.
   ;; The sequence is placed in a block, requiring a fixup to move the pop back
   ;; out of the block.
   nop
   local.set 0
  end
 )
)
