;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; Check that array types and operations are emitted properly in the binary format.

;; RUN: wasm-opt %s -all -S -o - | filecheck %s
;; RUN: wasm-opt %s -all --roundtrip -S -o - | filecheck %s --check-prefix=ROUNDTRIP

;; Check that we can roundtrip through the text format as well.

;; RUN: wasm-opt %s -all -S -o - | wasm-opt -all -S -o - | filecheck %s

(module
  ;; CHECK:      (type $i8_array (array (mut i8)))
  ;; ROUNDTRIP:      (type $i8_array (array (mut i8)))
  (type $i8_array (array (mut i8)))

  ;; CHECK:      (type $1 (func))

  ;; CHECK:      (global $arr (ref $i8_array) (array.new_default $i8_array
  ;; CHECK-NEXT:  (i32.const 4)
  ;; CHECK-NEXT: ))
  ;; ROUNDTRIP:      (type $1 (func))

  ;; ROUNDTRIP:      (global $arr (ref $i8_array) (array.new_default $i8_array
  ;; ROUNDTRIP-NEXT:  (i32.const 4)
  ;; ROUNDTRIP-NEXT: ))
  (global $arr (ref $i8_array)
    (array.new_default $i8_array (i32.const 4))
  )

  ;; CHECK:      (func $stores (type $1)
  ;; CHECK-NEXT:  (i32.store8 (type $i8_array)
  ;; CHECK-NEXT:   (global.get $arr)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (i32.store16 (type $i8_array)
  ;; CHECK-NEXT:   (global.get $arr)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (i32.store (type $i8_array)
  ;; CHECK-NEXT:   (global.get $arr)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (f32.store (type $i8_array)
  ;; CHECK-NEXT:   (global.get $arr)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:   (f32.const 0)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (i64.store8 (type $i8_array)
  ;; CHECK-NEXT:   (global.get $arr)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (i64.store16 (type $i8_array)
  ;; CHECK-NEXT:   (global.get $arr)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (i64.store32 (type $i8_array)
  ;; CHECK-NEXT:   (global.get $arr)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (f64.store (type $i8_array)
  ;; CHECK-NEXT:   (global.get $arr)
  ;; CHECK-NEXT:   (i32.const 0)
  ;; CHECK-NEXT:   (f64.const 0)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT: )
  ;; ROUNDTRIP:      (func $stores (type $1)
  ;; ROUNDTRIP-NEXT:  (i32.store8 (type $i8_array)
  ;; ROUNDTRIP-NEXT:   (global.get $arr)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:  )
  ;; ROUNDTRIP-NEXT:  (i32.store16 (type $i8_array)
  ;; ROUNDTRIP-NEXT:   (global.get $arr)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:  )
  ;; ROUNDTRIP-NEXT:  (i32.store (type $i8_array)
  ;; ROUNDTRIP-NEXT:   (global.get $arr)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:  )
  ;; ROUNDTRIP-NEXT:  (f32.store (type $i8_array)
  ;; ROUNDTRIP-NEXT:   (global.get $arr)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:   (f32.const 0)
  ;; ROUNDTRIP-NEXT:  )
  ;; ROUNDTRIP-NEXT:  (i64.store8 (type $i8_array)
  ;; ROUNDTRIP-NEXT:   (global.get $arr)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:  )
  ;; ROUNDTRIP-NEXT:  (i64.store16 (type $i8_array)
  ;; ROUNDTRIP-NEXT:   (global.get $arr)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:  )
  ;; ROUNDTRIP-NEXT:  (i64.store32 (type $i8_array)
  ;; ROUNDTRIP-NEXT:   (global.get $arr)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:  )
  ;; ROUNDTRIP-NEXT:  (f64.store (type $i8_array)
  ;; ROUNDTRIP-NEXT:   (global.get $arr)
  ;; ROUNDTRIP-NEXT:   (i32.const 0)
  ;; ROUNDTRIP-NEXT:   (f64.const 0)
  ;; ROUNDTRIP-NEXT:  )
  ;; ROUNDTRIP-NEXT: )
  (func $stores
    (i32.store8 (type $i8_array) (global.get $arr) (i32.const 0) (i32.const 0))
    (i32.store16 (type $i8_array) (global.get $arr) (i32.const 0) (i32.const 0))
    (i32.store (type $i8_array) (global.get $arr) (i32.const 0) (i32.const 0))
    (f32.store (type $i8_array) (global.get $arr) (i32.const 0) (f32.const 0))

    (i64.store8 (type $i8_array) (global.get $arr) (i32.const 0) (i32.const 0))
    (i64.store16 (type $i8_array) (global.get $arr) (i32.const 0) (i32.const 0))
    (i64.store32 (type $i8_array) (global.get $arr) (i32.const 0) (i32.const 0))
    (f64.store (type $i8_array) (global.get $arr) (i32.const 0) (f64.const 0))
  )
)
