;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; RUN: foreach %s %t wasm-opt -all --dae-optimizing -S -o - | filecheck %s

(module
 ;; CHECK:      (type $ref|array|_=>_i32 (func (param (ref array)) (result i32)))

 ;; CHECK:      (func $len (type $ref|array|_=>_i32) (param $0 (ref array)) (result i32)
 ;; CHECK-NEXT:  (drop
 ;; CHECK-NEXT:   (block $not_array (result (ref array))
 ;; CHECK-NEXT:    (return
 ;; CHECK-NEXT:     (array.len
 ;; CHECK-NEXT:      (br_on_cast_fail $not_array (ref array) (ref array)
 ;; CHECK-NEXT:       (local.get $0)
 ;; CHECK-NEXT:      )
 ;; CHECK-NEXT:     )
 ;; CHECK-NEXT:    )
 ;; CHECK-NEXT:   )
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT:  (i32.const -1)
 ;; CHECK-NEXT: )
 (func $len (param (ref eq)) (result i32)
  (drop
   (block $not_array (result (ref eq))
    (return
     (array.len
      (br_on_cast_fail $not_array (ref eq) (ref array)
       (local.get 0)
      )
     )
    )
   )
  )
  (i32.const -1)
 )
 ;; CHECK:      (func $optimize-after-refinement (type $ref|array|_=>_i32) (param $0 (ref array)) (result i32)
 ;; CHECK-NEXT:  (call $len
 ;; CHECK-NEXT:   (local.get $0)
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT: )
 (func $optimize-after-refinement (param (ref array)) (result i32)
  (call $len
   (local.get 0)
  )
 )
)
