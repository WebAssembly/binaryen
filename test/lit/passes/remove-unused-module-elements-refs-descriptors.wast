;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: foreach %s %t wasm-opt --remove-unused-module-elements --closed-world -all -S -o - | filecheck %s

;; The global.get of $global is the descriptor, not a field of the struct.
;; We should not try to optimize it away and error.
(module
 (rec
  ;; CHECK:      (rec
  ;; CHECK-NEXT:  (type $B (sub (descriptor $A (struct))))
  (type $B (sub (descriptor $A (struct))))
  ;; CHECK:       (type $A (sub (describes $B (struct))))
  (type $A (sub (describes $B (struct))))
 )

 ;; CHECK:      (type $2 (func))

 ;; CHECK:      (global $global (ref (exact $A)) (struct.new_default $A))
 (global $global (ref (exact $A)) (struct.new $A))

 ;; CHECK:      (export "export" (func $export))

 ;; CHECK:      (func $export (type $2)
 ;; CHECK-NEXT:  (drop
 ;; CHECK-NEXT:   (struct.new_default $B
 ;; CHECK-NEXT:    (global.get $global)
 ;; CHECK-NEXT:   )
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT: )
 (func $export (export "export")
  (drop
   (struct.new $B
    (global.get $global)
   )
  )
 )
)

