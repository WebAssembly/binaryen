;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; RUN: foreach %s %t wasm-opt -all --string-lifting -S -o - | filecheck %s

(module
  ;; CHECK:      (type $0 (func))

  ;; CHECK:      (import "\'" "foo" (global $string_foo (ref extern)))
  (import "\'" "foo" (global $string_foo (ref extern)))
  ;; CHECK:      (import "\'" "bar" (global $string_bar (ref extern)))
  (import "\'" "bar" (global $string_bar (ref extern)))

  ;; CHECK:      (func $func (type $0)
  ;; CHECK-NEXT:  (drop
  ;; CHECK-NEXT:   (string.const "foo")
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (drop
  ;; CHECK-NEXT:   (select (result (ref string))
  ;; CHECK-NEXT:    (string.const "bar")
  ;; CHECK-NEXT:    (string.const "bar")
  ;; CHECK-NEXT:    (i32.const 1)
  ;; CHECK-NEXT:   )
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT: )
  (func $func
    (drop
      (global.get $string_foo)
    )
    ;; Test multiple uses of the same constant, and that we update types.
    (drop
      (select (result externref)
        (global.get $string_bar)
        (global.get $string_bar)
        (i32.const 1)
      )
    )
  )
)
