;; NOTE: Assertions have been generated by update_lit_checks.py and should not be edited.
;; RUN: foreach %s %t wasm-opt -all --dae -S -o - | filecheck %s

(module
  (func $called
    (param $opt (ref null func))  ;; optimizable
    (param $already (ref func))   ;; already refined
    (param $also (ref null func)) ;; also optimizable
    (param $no-cast (ref null func)) ;; no cast at all
    (param $late-cast (ref null func)) ;; cast is not in entry
    (drop
      (ref.cast func
        (local.get $opt)
      )
    )
    (drop
      (ref.cast func
        (local.get $already)
      )
    )
    (drop
      (ref.cast func
        (local.get $also)
      )
    )
    (drop
      (local.get $no-cast)
    )
    (if
      (i32.const 0)
      (return)
    )
    (drop
      (ref.cast func
        (local.get $late-cast)
      )
    )
  )

  (func $caller (param $x (ref null func)) (param $y (ref func))
    (call $called
      (local.get $x)
      (local.get $y)
      (local.get $x)
      (local.get $x)
      (local.get $x)
    )
  )
)
