;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; RUN: foreach %s %t wasm-opt -all --deinstrument-branch-hints -S -o - | filecheck %s

(module
  (func $if
    (local $temp i32)
    ;; The instrumentation should be removed, and if the if's condition should
    ;; be 42.
    (@metadata.code.branch_hint "\00")
    (if
      (block (result i32)
        (local.set $temp
          (i32.const 42)
        )
        (call $log-branch
          (i32.const 1)
          (i32.const 0)
          (local.get $temp)
        )
        (local.get $temp)
      )
      (then
        (drop
          (i32.const 1337)
        )
      )
      (else
        (drop
          (i32.const 99)
        )
      )
    )
  )

  (func $br (type $temp)
    ;; The same, with a br.
    (local $temp i32)
    (block $out
      (@metadata.code.branch_hint "\01")
      (br_if $out
        (block (result i32)
          (local.set $temp
            (i32.const 42)
          )
          (call $log-branch
            (i32.const 4)
            (i32.const 0)
            (local.get $temp)
          )
          (local.get $temp)
        )
      )
    )
  )
)
