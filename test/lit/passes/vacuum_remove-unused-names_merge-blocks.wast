;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; NOTE: This test was ported using port_test.py and could be cleaned up.

;; RUN: foreach %s %t wasm-opt --vacuum --remove-unused-names --merge-blocks -S -o - | filecheck %s

(module
  ;; vacuum and remove-unused names leave us with a return at the top, and then
  ;; merge-blocks wants to move the first line of the block into an outer block
  ;; that then becomes the fallthrough of the function, so it must be properly typed.
  ;; and here the new last element is a return, with unreachable type, bad for a block
  ;; in that position
  ;; CHECK:      (type $i32_=>_i32 (func (param i32) (result i32)))

  ;; CHECK:      (func $return-block (param $x i32) (result i32)
  ;; CHECK-NEXT:  (local.set $x
  ;; CHECK-NEXT:   (local.get $x)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT:  (return
  ;; CHECK-NEXT:   (local.get $x)
  ;; CHECK-NEXT:  )
  ;; CHECK-NEXT: )
  (func $return-block (param $x i32) (result i32)
    (return
      (block (result i32)
        (local.set $x (local.get $x))
        (local.get $x)
      )
    )
  )
)

