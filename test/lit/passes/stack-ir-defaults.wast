;; NOTE: Assertions have been generated by update_lit_checks.py and should not be edited.

;; Request StackIR explicitly. This optimizes.
;; RUN: wasm-opt %s --generate-stack-ir --optimize-stack-ir -all               --print-stack-ir | filecheck %s --check-prefix=REQUESTED

;; As above, but disallow it later. This does not optimize.
;; RUN: wasm-opt %s --generate-stack-ir --optimize-stack-ir -all --no-stack-ir --print-stack-ir | filecheck %s --check-prefix=DISALLOWD

;; As above, but flip it, so we allow it after disallowing. This optimizes.
;; RUN: wasm-opt %s --no-stack-ir --generate-stack-ir --optimize-stack-ir -all --print-stack-ir | filecheck %s --check-prefix=REALLOWED

;; Running -O will use StackIR by default. This optimizes.
;; RUN: wasm-opt %s -O               -all --print-stack-ir | filecheck %s --check-prefix=O_DEFAULT

;; As above, but disallow it. This does not optimize.
;; RUN: wasm-opt %s -O --no-stack-ir -all --print-stack-ir | filecheck %s --check-prefix=O__DENIED

;; As above, but flip it. ???
;; RUN: wasm-opt %s --no-stack-ir -O -all --print-stack-ir | filecheck %s --check-prefix=O_REALLOW

(module
  (import "a" "b" (func $import (result i32))

  (func $func (export "func") (result i32)
    ;; This drop can be removed when we optimize using StackIR.
    (drop
      (call $import)
    )
    (unreachable)
  )
)
