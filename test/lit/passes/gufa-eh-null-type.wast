;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; RUN: foreach %s %t wasm-opt -all --gufa -S -o - | filecheck %s

;; The function here will use a NullLocation for (ref exn) as well as a
;; TypeLocation for that very same type. We should not get confused and end up
;; optimizing anything here.

(module
 (type $func (func))

 (tag $tag (type $func))

 (func $func (export "func")
  (local $1 (ref exn))
  ;; This part ends up generating a TypeLocation for (ref exn).
  (drop
   (block $block (result (ref exn))
    (try_table (catch_all_ref $block)
     (throw $tag)
    )
    (return)
   )
  )
  (try
   (do
    (nop)
   )
   (catch $tag
    (drop
     (block $block (result (ref exn))
      ;; This part ends up generating a NullLocation for (ref exn).
      (br_on_non_null $block
       (local.tee $1
        (unreachable)
       )
       (ref.null noexn)
      )
      (drop
       (local.get $1)
      )
     )
    )
   )
  )
 )
)
