;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; RUN: foreach %s %t wasm-opt --remove-unused-module-elements --closed-world -all -S -o - | filecheck %s
;; RUN: foreach %s %t wasm-opt --remove-unused-module-elements                -all -S -o - | filecheck %s --check-prefix OPEN_WORLD

(module
  (type $externs (array (mut externref)))

  (type $funcs (array (mut funcref)))

  (type $bytes (array (mut i8)))

  (type $configureAll (func (param (ref null $externs)) (param (ref null $funcs)) (param (ref null $bytes)) (param externref)))

  (import "wasm:js-prototypes" "configureAll" (func $configureAll (type $configureAll)))

  (elem $externs funcref
    (ref.null extern)
  )

  (elem $funcs funcref
    (ref.func $foo)
    (ref.func $bar)
  )

  (data $bytes "12345678")

  (start $start)

  (func $start
    (call $configureAll
      (array.new_elem $externs $externs
        (i32.const 0) (i32.const 1))
      (array.new_elem $funcs $funcs
        (i32.const 0) (i32.const 3))
      (array.new_data $bytes $data
        (i32.const 0) (i32.const 23))
      (global.get $constructors)
    )
  )

  (func $foo
  )

  (func $bar
  )
)
