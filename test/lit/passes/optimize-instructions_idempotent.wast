;; NOTE: Assertions have been generated by update_lit_checks.py and should not be edited.

;; RUN: wasm-opt %s --optimize-instructions -all -S -o - | filecheck %s

;; Idempotent-marked functions can be assumed to always return the same value.

;; RUN: wasm-opt %s --optimize-instructions -all -S -o - | filecheck %s --check-prefix=NO_FO

(module
  (@binaryen.idempotent)
  (func $idempotent (param $x f32) (result f32)
    ;; This function is idempotent.
    (f32.const 13.37)
  )

  (func $potent (param $x f32) (result f32)
    ;; This function is not idempotent
    (local.get $x)
  )

  (func $test-abs
    ;; These calls are identical, since the second returns the same. We can
    ;; remove the abs, as multiplying a value by itself is non-negative anyhow.
    (drop
      (f32.abs
        (call $idempotent)
        (call $idempotent)
      )
    )
    ;; But here we can do nothing
    (drop
      (f32.abs
        (call $potent)
        (call $potent)
      )
    )
  )
)
