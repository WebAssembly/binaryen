;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: foreach %s %t wasm-opt --nominal --type-merging -all -S -o - | filecheck %s

(module
  (type $A (struct_subtype (field i32) data))

  (type $B (struct_subtype (field i32) data))

  (type $C (struct_subtype (field i32) (field f64) data))

  (type $D (struct_subtype (field i32) data))

  (func $foo
    (local $a (ref $A))
    ;; $B can be merged into $A.
    (local $b (ref $B))
    ;; $C cannot because it adds a field.
    (local $c (ref $C))
    ;; $D cannot because it has a cast.
    (local $d (ref $D))

    ;; A cast of $A has no effect.
    (drop
      (ref.cast $A
        (local.get $A)
      )
    )
    ;; A cast of $D prevents it from being merged.
    (drop
      (ref.cast $D
        (local.get $A)
      )
    )
  )
)
