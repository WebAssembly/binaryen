;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; RUN: wasm-opt %s --memory-packing -all --zero-filled-memory      -S -o - | filecheck %s
;; RUN: wasm-opt %s --memory-packing -all --zero-filled-memory -tnh -S -o - | filecheck %s --check-prefix=_TNH_

;; We should not optimize out a segment that will trap, as that is an effect we
;; need to preserve (unless TrapsNeverHappen).
(module
  (memory 1 2 shared)
  (data (i32.const -1) "\00")
)

;; This segment will almost trap, but not.
(module
  (memory 1 2 shared)
  (data (i32.const 65535) "\00")
)

;; This one is slightly larger, and will trap.
(module
  (memory 1 2 shared)
  (data (i32.const 65535) "\00\00")
)

;; This one's offset is just large enough to trap.
(module
  (memory 1 2 shared)
  (data (i32.const 65536) "\00")
)

;; This offset is unknown, so assume the worst.
(module
  (import "a" "b" (global $g i32))
  (memory 1 2 shared)
  (data (global.get $g) "\00")
)
