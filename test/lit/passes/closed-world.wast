;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: foreach %s %t wasm-opt -O2                --nominal -all -S -o - | filecheck %s --check-prefix OPEN_WORLD
;; RUN: foreach %s %t wasm-opt -O2 --closed-world --nominal -all -S -o - | filecheck %s --check-prefix CLOSED_WORLD

;; Test both open world (default) and closed world. In a closed world we can do
;; more with struct types and so we run more passes, whose impact is noticeable
;; in this test, which verifies we don't run them in an open world. Each test
;; verifies a particular pass is run or not run in -O2 and above.

;; --type-refining
(module
  (type $struct (struct_subtype (field (mut anyref)) data))

  (func $work (param $struct (ref $struct))
    (struct.set $struct 0
      (local.get $struct)
      (ref.null none)
    )
    (drop
      (struct.get $struct 0
        (local.get $struct)
      )
    )
  )
)

