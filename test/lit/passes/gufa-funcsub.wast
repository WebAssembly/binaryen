;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: foreach %s %t wasm-opt -all --gufa -S -o - | filecheck %s

;; Function subtyping in results.
(module
 (rec
  ;; CHECK:      (rec
  ;; CHECK-NEXT:  (type $super (sub (func (result i32))))
  (type $super (sub (func (result i32))))
  ;; CHECK:       (type $sub (sub $super (func (result i32))))
  (type $sub (sub $super (func (result i32))))
 )

 ;; CHECK:      (type $2 (func (param i32)))

 ;; CHECK:      (table $table 3 funcref)
 (table $table i32 3 funcref)
 ;; CHECK:      (elem $elem (i32.const 0) $super $sub)
 (elem $elem (i32.const 0) $super $sub)

 ;; CHECK:      (export "export" (func $export))

 ;; CHECK:      (func $super (type $super) (result i32)
 ;; CHECK-NEXT:  (i32.const 0)
 ;; CHECK-NEXT: )
 (func $super (type $super) (result i32)
  (i32.const 0)
 )

 ;; CHECK:      (func $sub (type $sub) (result i32)
 ;; CHECK-NEXT:  (i32.const 1)
 ;; CHECK-NEXT: )
 (func $sub (type $sub) (result i32)
  (i32.const 1)
 )

 ;; CHECK:      (func $export (type $2) (param $x i32)
 ;; CHECK-NEXT:  (drop
 ;; CHECK-NEXT:   (call_indirect $table (type $super)
 ;; CHECK-NEXT:    (local.get $x)
 ;; CHECK-NEXT:   )
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT:  (drop
 ;; CHECK-NEXT:   (block (result i32)
 ;; CHECK-NEXT:    (drop
 ;; CHECK-NEXT:     (call_indirect $table (type $sub)
 ;; CHECK-NEXT:      (local.get $x)
 ;; CHECK-NEXT:     )
 ;; CHECK-NEXT:    )
 ;; CHECK-NEXT:    (i32.const 1)
 ;; CHECK-NEXT:   )
 ;; CHECK-NEXT:  )
 ;; CHECK-NEXT: )
 (func $export (export "export") (param $x i32)
  ;; Call using the supertype. We might be calling the subtype too, so we can't
  ;; infer the result.
  (drop
   (call_indirect $table (type $super)
    (local.get $x)
   )
  )
  ;; Call using the subtype. Now we can infer the return value.
  (drop
   (call_indirect $table (type $sub)
    (local.get $x)
   )
  )
 )
)

