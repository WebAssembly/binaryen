;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.

;; Enable both normal and partial inlining, and show how we filter out functions
;; using --no-*-inline

;; RUN: foreach %s %t wasm-opt --optimize-level=3 --inlining --partial-inlining-ifs=1 -S -o - | filecheck %s --check-prefix NORMAL

(module
  (import "a" "b" (func $import))

  (func $full-yes-inline (param $x i32)
    (call $import)
  )

  (func $full-no-inline (param $x i32)
    (call $import)
  )

  (func $partial-yes-inline (param $x i32)
    (if
      (local.get $x)
      (return)
    )
    (loop $l
      (call $import)
      (br $l)
    )
  )

  (func $partial-no-inline (param $x i32)
    (if
      (local.get $x)
      (return)
    )
    (loop $l
      (call $import)
      (br $l)
    )
  )

  (func $caller
    ;; The "yes" functions will be inlined, but no the "no"
    (call $full-yes-inline)
    (call $full-no-inline)
    (call $partial-yes-inline)
    (call $partial-no-inline)
  )
)
