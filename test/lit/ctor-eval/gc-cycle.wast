;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: wasm-ctor-eval %s --ctors=test --kept-exports=test --quiet -all -S -o - | filecheck %s

(module
 (type $A (struct (field (mut (ref null $A))) (field i32)))

 (global $a (mut (ref null $A)) (ref.null $A))

 (func "test"
  (local $a (ref $A))
  (global.set $a
   (local.tee $a
    (struct.new $A
     (ref.null $A)
     (i32.const 42)
    )
   )
  )
  (struct.set $A 0
   (local.get $a)
   (local.get $a)
  )
 )

 (func "keepalive" (result i32)
  (struct.get $A 1
   (global.get $a)
  )
 )
)
;; CHECK:      (export "test" (func $0))

;; CHECK:      (func $0 (type $none_=>_none)
;; CHECK-NEXT:  (drop
;; CHECK-NEXT:   (array.new_data $[i8] $1
;; CHECK-NEXT:    (i32.const 16)
;; CHECK-NEXT:    (i32.const 8)
;; CHECK-NEXT:   )
;; CHECK-NEXT:  )
;; CHECK-NEXT: )
