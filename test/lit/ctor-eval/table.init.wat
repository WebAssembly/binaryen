;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: wasm-ctor-eval %s --ctors=run --kept-exports=run --quiet -all -S -o - | filecheck %s

(module
 ;; CHECK:      (type $none_=>_none (func))
 (type $none_=>_none (func))

 ;; CHECK:      (table $table 22 funcref)
 (table $table 22 funcref)

 ;; CHECK:      (elem $init (i32.const 0) $nop)
 (elem $init (i32.const 0) $nop)

 ;; CHECK:      (elem $later func $trap)
 (elem $later $trap)

 (export "run" (func $run))

 (func $run (type $none_=>_none)
  ;; This call can be evalled away (it does nothing as the target is a nop).
  (call_indirect $table (type $none_=>_none)
   (i32.const 0)
  )

  ;; We stop at this table.init, which is not handled yet. The call after it
  ;; should also remain where it is.
  (table.init $table $later
   (i32.const 0)
   (i32.const 0)
   (i32.const 1)
  )
  (call_indirect $table (type $none_=>_none)
   (i32.const 0)
  )
 )

 ;; CHECK:      (export "run" (func $run_3))

 ;; CHECK:      (func $nop (type $none_=>_none)
 ;; CHECK-NEXT:  (nop)
 ;; CHECK-NEXT: )
 (func $nop (type $none_=>_none)
  (nop)
 )

 ;; CHECK:      (func $trap (type $none_=>_none)
 ;; CHECK-NEXT:  (unreachable)
 ;; CHECK-NEXT: )
 (func $trap (type $none_=>_none)
  (unreachable)
 )
)
;; CHECK:      (func $run_3 (type $none_=>_none)
;; CHECK-NEXT:  (table.init $table $later
;; CHECK-NEXT:   (i32.const 0)
;; CHECK-NEXT:   (i32.const 0)
;; CHECK-NEXT:   (i32.const 1)
;; CHECK-NEXT:  )
;; CHECK-NEXT:  (call_indirect $table (type $none_=>_none)
;; CHECK-NEXT:   (i32.const 0)
;; CHECK-NEXT:  )
;; CHECK-NEXT: )
