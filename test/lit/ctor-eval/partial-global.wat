;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: wasm-ctor-eval %s --ctors=test --kept-exports=test --quiet -all -S -o - | filecheck %s

(module
 ;; CHECK:      (type $none_=>_none (func))

 ;; CHECK:      (global $global (mut i32) (i32.const 999))
 (global $global (mut i32) (i32.const 0))

 (func "test"
  ;; The nop can be evalled away, but not the loop. We should not apply any
  ;; partial results from the loop - in particular, the global must remain at
  ;; 0.
  (nop)
  (loop
   (global.set $global
    (i32.const 999) ;; this must not be applied to the global!
   )
   (unreachable)
  )
 )
)

;; CHECK:      (export "test" (func $0_1))

;; CHECK:      (func $0_1 (type $none_=>_none)
;; CHECK-NEXT:  (global.set $global
;; CHECK-NEXT:   (i32.const 999)
;; CHECK-NEXT:  )
;; CHECK-NEXT:  (unreachable)
;; CHECK-NEXT: )
